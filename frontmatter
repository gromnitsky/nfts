#!/usr/bin/env node

let read = require('util').promisify(require('fs').readFile)
let front_matter = require('front-matter')

read(process.argv[2], {encoding: 'utf8'})
    .then(parse).then(generate_shell_code).then(print).catch( e => {
	console.error(e)
	process.exit(1)
    })

function parse(text) { return front_matter(text) }

function generate_shell_code(fm) {
    return ['title', 'date', 'author'].map( key => {
	let val = fm.attributes[key]
	return {
	    var: key,
	    val: (val instanceof Date ? val.valueOf() : val || '').toString()
	}
    }).concat({ var: 'body', val: fm.body })
}

function print(code) {
    let quote = s => "'" + s.trim().replace(/'/g, "'\\''") + "'"
    code.map( assign => console.log(`${assign.var}=${quote(assign.val)}`))
}
